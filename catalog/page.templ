package catalog

import (
	"github.com/derstruct/doors-tutorial/common"
	"github.com/doors-dev/doors"
)

type Path = common.CatalogPath

type catalogPage struct {
	path doors.SourceBeam[Path]
}

templ (c *catalogPage) Head() {
	<title>catalog</title>
}

func (c *catalogPage) Body() templ.Component {
	b := doors.NewBeam(c.path, func(p Path) bool {
		return p.IsMain
	})
	return doors.Sub(b, func(isMain bool) templ.Component {
		if isMain {
			return main()
		}
		return category()
	})
}

func (c *catalogPage) Render(b doors.SourceBeam[Path]) templ.Component {
	c.path = b
	return common.Template(c)
}

func Handler(p doors.PageRouter[Path], r doors.RPage[Path]) doors.PageRoute {
	return p.Page(&catalogPage{})
}
